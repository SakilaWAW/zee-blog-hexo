---
layout: post
title:  "有关科学上网的基本原理"
date:   2020-11-03 11:02:06 +0800
categories: 程序员的基本素养
tags: 科学上网
banner_img: /images/scientific-internet-access/banner.jpg
index_img: /images/scientific-internet-access/banner.jpg
comments: true
---

> 最近研究了下有关梯子的原理和构建方法，感到很复杂，很有趣。这篇文章旨在记录我在研究中的一些重要的点(谁叫我记性不好呢)。

一、原理

主要由于一些政治因素吧，GFW出现了，出现的原因不是我们关心的重点，本节主要说说GFW的基本原理。通俗的来讲就是在网络出口处设置了一个审查装置，来定向的封锁某些符合特征的数据包，在我们大众的视角里体现为一些网站上不去了。我们以时间顺序简单说明下原理的演进:

1. 最初的时候

![gfw原理](/images/scientific-internet-access/gfw-theory-1.png)

没有gfw的时候，我们的PC和外网服务器还没有隔阂。和多年前一样，请求经由路由器、骨干网、DNS服务器转发到目标服务器。

2. GFW的出现

有一天，GFW出现了，那么它都做了些什么呢？

- GFW可以在我们进行DNS服务器解析的时候进行`域名污染`：当GFW发现我们访问的域名为需要拦截的，就返回一个假的结果。

- GFW查看请求的内容，如果发现需要拦截的关键字，就对其进行阻断，此为`关键字阻断`

- `端口阻断`：GFW可以对一些常用的端口进行阻断，比如443，22等

- 经过长时间的积累，GFW将可以的IP地址记录下来，如果发现，直接阻断，这就是`IP地址阻断`

当然随着时间的积累，技术也在迭代更新，阻断的方式也会越来越多。

我们不必强求了解所有的阻断方式，即使强求也得不到所有的，除非你认识GFW的架构师而且他愿意告诉你(ﾟ▽ﾟ)/

3. 原始的梯子

就像黑暗和光明是结伴而生，GFW的出现也一定会伴随着破解程序的出现，也就是我们所说的梯子。最早的梯子使用的原理叫做VPN(Virtual Private Network)：

![VPN原理](/images/scientific-internet-access/gfw-theory-2.png)

通过上图代理的方式确实可以完美规避GFW的监测，但是好景不长，GFW发现短期内出现大量通过VPN上外网的行为，所以出了应对措施：封闭VPN请求需要的端口，如果使用，必须报备，并且记录可疑代理的IP地址实行IP封锁。措施一经推出，基本VPN这种方式就行不通了。

4. 救世主ShadowSocks协议


VPN倒下后，难道就没有方法穿过GFW了吗？不，救世主ShadowSocks(以下简称SS)适时的出现了，SS的出现打破了僵局。

![SS原理](/images/scientific-internet-access/gfw-theory-3.png)

既然建立加密通道请求会被作为特征被识别，我们在通过GFW之前提前加密不就好了。SS这种方式让GFW很难辨别(当然现在这种方式肯定还是可能被嗅探到的，毕竟GFW原理谁也说不清)。

5. 新生代V2Ray和Trojan等

无敌的SS顶住压力后，有一些新生代协议也随之诞生，其中比较有名的要数V2Ray和Trojan，不过一句话来说这些协议都是在SS的基础上构建，各有优劣。V2Ray相比SS多了几次加密，安全性稍好一些，但相对的性能稍差、Trojan在V2Ray的基础上针对TLS+Websocket这个方式进行了优化，但是代价是只能用这个协议，不那么通用。这些协议包括很多没说的协议的原理对于我来说不重要，所以也不多说了。

二、自建SS还是机场

其实这些原理说起来也简单，有些人可能会觉得自己做一个会很容易。其实不然，自建SS真正的难点在于GFW对我们来说是一个黑盒，我们对其原理不甚清楚，而且网络数据的流动需要经过多个节点。当我们发现我们自建的SS使用不了时，如何快速定位问题才是难点，即使刚建起来的时候心情非常澎湃，像是干了件多大的丰功伟业，但是当这个SS被封很多次之后，在重建的过程中我们的热情也会被消磨殆尽。

所以综合来说如果做SS只是为了玩儿，那自建SS的确挺好玩儿的，但是如果我们只是想看看油管，刷刷twitter、ins，那么选择一个好的机场才是正道。

三、总结

整体来讲科学上网从原理上还是比较简单的，了解这些底层知识可以有效提高我们对网络基础，特别是网络代理这块的理解。对于我这种一般用户来说，使用机场就足够了，但真要落实到一个性价比高的机场，还得进行不断的尝试，如果有机会，在使用过一些机场后我会新开一篇文章来写一写使用体验。